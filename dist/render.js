this.wdg=this.wdg||{},this.wdg.charts=this.wdg.charts||{},this.wdg.charts.render=function(e,t){"use strict";function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=a(t);const n=window.wdg.charts.config||{};function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={...n,...e,...t};if(a.data.axes=a.data.axes||{},a.axis&&a.axis.y&&a.axis.y.secondary&&(a.data.axes={},a.data.rows.length>0&&(a.data.rows[0].filter((e=>e)).forEach((e=>{Array.isArray(a.axis.y.secondary)&&a.axis.y.secondary.includes(e)||a.axis.y.secondary===e?a.data.axes[e]="y2":a.data.axes[e]="y"})),a.axis.y2.show=Object.keys(a.data.axes).map((e=>a.data.axes[e])).filter((e=>"y2"===e)).length>0)),a?.padding?.auto&&delete a.padding,a.hasOwnProperty("caption")&&delete a.caption,"%Y:$QQ"===a.axis.x.tick.format?a.axis.x.tick.format=function(e){return`${e.getFullYear()}:Q${[1,1,1,2,2,2,3,3,3,4,4,4][e.getMonth()]}`}:"%Y:$HH"===a.axis.x.tick.format&&(a.axis.x.tick.format=function(e){return`${e.getFullYear()}:H${e.getMonth()<=5?"1":"2"}`}),a.axis&&a.axis.y&&a.axis.y.label&&!a.axis.y.label.text&&delete a.axis.y.label,a.trend&&a.trend.show){const t=s(a,a.trend.col);if(t){const r=a.trend.label||"Trend";a.data.types={...e.data.types||{},[r]:"line"},a.data.rows=[...a.data.rows];for(let e=0,n=a.data.rows.length;e<n;e++)a.data.rows[e]=0===e?[...a.data.rows[e],r]:[...a.data.rows[e],t.values[e-1]];a.color.pattern=[...a.color.pattern],""===a.data.rows[0][0]?a.color.pattern[a.data.rows[0].length-2]="#000000":a.color.pattern[a.data.rows[0].length-1]="#000000"}}return a}function s(e){function t(e){return a(e)/e.length}function a(e){return e.reduce(((e,t)=>e+t),0)}let r;if(!e.data.rows.length)return;if(e.trend.col?r=e.data.rows[0].indexOf(e.trend.col):e.data.rows[0].length&&(r=0),r<0)return null;const n=[...Array(e.data.rows.length-1).keys()],o=e.data.rows.slice(1).map((e=>parseFloat(e[r]))),s=t(n),d=t(o),i=n.map((e=>e-s)),l=o.map((e=>e-d)),c=i.map((e=>Math.pow(e,2))),h=[];for(let t=0,a=e.data.rows.length;t<a-1;t++)h.push(i[t]*l[t]);const u=a(h)/a(c),g=d-u*s,f=[];for(let t=1,a=e.data.rows.length;t<a;t++)f.push(g+u*n[t-1]);return{slope:u,yStart:g,calcY:e=>g+u*e,values:f}}function d(e){const t=getComputedStyle(e),a={text:["color","fill","fontSize","fontFamily"],default:["backgroundColor","color","display","fill","opacity","shapeRendering","stroke","strokeDasharray","strokeDashoffset","strokeOpacity","strokeWidth","visibility"]};(a[e.tagName.toLowerCase()]||a.default).forEach((a=>{t[a]&&(e.style[a]=t[a])}))}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#ffffff";return new Promise(((r,n)=>{if(!e instanceof SVGElement)return n(new Error("SVGElement is required"));if(!t.match(/^image\//))return n(new Error(`Invalid mime type: ${t}`));const{height:o,width:s}=e.getBoundingClientRect(),i=e.cloneNode(!0),l=document.createElement("div");l.style.position="absolute",l.style.overflow="hidden",l.style.pointerEvents="none",l.style.userSelect="none",l.style.height="1px",l.style.width="1px",i.style.backgroundColor="#fff",i.setAttribute("height",2*o+"px"),i.setAttribute("width",2*s+"px"),i.setAttribute("viewBox",`0 0 ${s} ${o}`),e.parentNode.insertBefore(l,e),l.appendChild(i),i.querySelectorAll("path,text,circle,g,line,text").forEach(d);const c=(new XMLSerializer).serializeToString(i),h=new Image,u=document.createElement("canvas"),g=u.getContext("2d");u.width=2*s,u.height=2*o,h.onload=()=>{g.fillStyle=a,g.drawImage(h,0,0),r(u.toDataURL(t)),l.parentNode.removeChild(l)},h.onerror=n,h.src=`data:image/svg+xml; charset=utf8, ${encodeURIComponent(c)}`}))}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Download chart",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"chart.png";const r=document.createElement("a");return r.classList.add("wdg-c3-charts__export"),r.download=a,r.innerText=t,r.onclick=t=>{t.preventDefault(),setTimeout((()=>{i(e).then((e=>{const t=document.createElement("a");t.download=r.download,t.href=e,t.click()}))}),200)},r}function c(e){let t={};const a=e.querySelector('script[type="application/json"]'),n=document.createElement("div");if(a){try{t=JSON.parse(a.textContent)}catch(e){return void console.error("wdg-c3-charts: Invalid json",a.textContent)}a.insertAdjacentElement("afterend",n),t=o(t,{bindto:n});const r=function(e){const t=["wdg-c3-chart"];return e?.data?.type&&(t.push(`wdg-c3-chart--${e.data.type}`),["line","bar","area","area-spline","spline"].includes(e.data.type)&&(e?.grid?.x?.stroke&&t.push(`wdg-c3-chart--x-grid-line-${e.grid.x.stroke}`),e?.grid?.y?.stroke&&t.push(`wdg-c3-chart--y-grid-line-${e.grid.y.stroke}`))),t}(t);r.length&&r.forEach((t=>e.classList.add(t)));{let a,r;const n=document.createElement("p");n.classList.add("wdg-c3-charts__export-wrap"),t.oninit=()=>{r=e.querySelector("svg"),a=l(r,t.downloadText||"Download chart",t.downloadName||"chart"),e.insertAdjacentElement("afterend",n),n.appendChild(a)},t.onrendered=()=>{i(r).then((e=>a.href=e)).catch((e=>console.error(e.message)))}}}return r.default.generate(t)}return e.charts=void 0,document.addEventListener("DOMContentLoaded",(()=>{e.charts=Array.from(document.querySelectorAll(".wdg-c3-chart")).map(c)})),e.applyStylesInline=d,e.createDownloadLink=l,e.generateExport=i,e.render=c,Object.defineProperty(e,"__esModule",{value:!0}),e}({},c3);
//# sourceMappingURL=render.js.map
